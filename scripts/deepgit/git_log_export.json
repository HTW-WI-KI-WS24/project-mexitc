[
  {
    "message": "changes in routing",
    "additions": [
      "@@ -25,7 +25,7 @@\n       work correctly both with client-side routing and a non-root public URL.\n       Learn how to configure a non-root public URL by running `npm run build`.\n     -->\n-    <title>React App</title>\n+    <title>GERIATRIK</title>\n   </head>\n   <body>\n     <noscript>You need to enable JavaScript to run this app.</noscript>",
      "@@ -1,6 +1,6 @@\n {\n-  \"short_name\": \"React App\",\n-  \"name\": \"Create React App Sample\",\n+  \"short_name\": \"GERIATRIK\",\n+  \"name\": \"GERIATRIK\",\n   \"icons\": [\n     {\n       \"src\": \"favicon.ico\",",
      "@@ -11,8 +11,8 @@ function App() {\n         <Router>\n             <Fragment>\n                 <Routes>\n-                    <Route exact path='/' element = {<Home/>}/>\n-                    <Route exact path='/login' element = {<Login/>}/>\n+                    <Route exact path='/' element = {<Login/>}/>\n+                    <Route exact path='/home' element = {<Home/>}/>\n                     <Route exact path='/Register' element = {<Register/>}/>\n                 </Routes>\n             </Fragment>",
      "@@ -16,7 +16,7 @@ const Login = () => {\n \n     const onSubmit = e => {\n         e.preventDefault();\n-        navigate('/');\n+        navigate('/home');\n         /*if(email === '' || password === ''){\n             //missing inputs\n         }else{",
      "@@ -29,7 +29,7 @@ const Register = props => {\n             //passwords do not match\n         }else{\n             //register\n-            navigate('/');\n+            navigate('/home');\n         }\n     }\n     \n@@ -45,7 +45,7 @@ const Register = props => {\n                     <input placeholder='Confirmar Contrase\u00f1a' type='password' name = 'password2' value={password2} onChange = {onChange} required minLength={6}/>\n                     <input type=\"submit\" value = \"Registarse\"/>\n                 </form>\n-                <button className='btn-back' onClick={() => navigate('/login', { replace: true })}> Atr\u00e1s</button>\n+                <button className='btn-back' onClick={() => navigate('/', { replace: true })}> Atr\u00e1s</button>\n \n             </div>\n             <div>"
    ]
  },
  {
    "message": "Merge pull request #18 from CarloLj/login/register\n\ntoken check and various fixes",
    "additions": [
      "@@ -9,7 +9,15 @@ import Reports from \"./components/pages/Reports\";\n import Navbar from \"./components/Navbar\";\n import Patient from \"./components/pages/PatientCards/Patient\";\n import Moca from \"./components/pages/MocaPage/Moca\";\n-import NewPatient from './components/newPatient/NewPatient';\n+\n+\n+//utils\n+import setAuthToken from \"./utils/setAuthToken\";\n+\n+//set auth token for all the web app\n+if(localStorage.getItem('token')){\n+    setAuthToken(localStorage.getItem('token')); \n+}\n \n function App() {\n     return (\n@@ -21,7 +29,6 @@ function App() {\n                     <Route exact path='/home' element = {<Home/>}/>\n                     <Route exact path='/Register' element = {<Register/>}/>\n                     <Route exact path='/PatientCard/:id' element = {<Patient/>}/>\n-                    <Route exact path='/NewPatient' element = {<NewPatient/>}/>\n                 </Routes>\n             </Fragment>\n         </Router>",
      "@@ -135,11 +135,11 @@ const Register = props => {\n                                 <input placeholder='Correo Electr\u00f3nico' type='email' name = 'email' value={email} onChange = {onChange} required/>\n                                 <div>\n                                     <i className=\"bi bi-eye\" id=\"togglePassword\" onClick={showPassword}/>\n-                                    <input id = \"password\" placeholder='Contrase\u00f1a' type='password' name = 'password' value={password} onChange = {onChange} required/>\n+                                    <input id = \"password\" placeholder='Contrase\u00f1a' type='password' name = 'password' value={password} onChange = {onChange} required minLength={6}/>\n                                 </div>\n                                 <div>\n                                     <i className=\"bi bi-eye\" id=\"togglePassword2\" onClick={showPassword2}/>\n-                                    <input id = \"password2\" placeholder='Confirmar' type='password' name = 'password2' value={password2} onChange = {onChange} required/>\n+                                    <input id = \"password2\" placeholder='Confirmar' type='password' name = 'password2' value={password2} onChange = {onChange} required minLength={6}/>\n                                 </div>\n                                 <input placeholder='URL img de perfil' type='text' name = 'pfp' value={pfp} onChange = {onChange} required/>\n ",
      "@@ -116,11 +116,11 @@ const AddPatientButton = () => {\n \n     return(\n         <section>\n-            <a href=\"#\" class='addPatientButton' onClick={open}>.</a>\n-            <div class = \"modal-container\">\n-                <div class = \"modal modal-close\">\n-                    <a class = \"close\" onClick={close}>X</a>\n-                    <div class = \"modal-text\">\n+            <a href=\"#\" className='addPatientButton' onClick={open}>.</a>\n+            <div className = \"modal-container\">\n+                <div className = \"modal modal-close\">\n+                    <a className = \"close\" onClick={close}>X</a>\n+                    <div className = \"modal-text\">\n                         <h2 className='header'>Agregar nuevo paciente</h2>\n                         <form id = \"formulario\" onSubmit={onSubmit}>\n                             <div className='grid-2'>\n@@ -138,20 +138,20 @@ const AddPatientButton = () => {\n                                 </div>\n                                 <div>\n                                     <input placeholder='Discapacidades' type='text' name = 'disabilities' value={disabilities} onChange = {onChange} required/>\n-                                    <div class ='toggle-div'>\n-                                        <label class ='toggle-label'>Queja de Memoria</label>\n-                                        <label class=\"toggle\">\n+                                    <div className ='toggle-div'>\n+                                        <label className ='toggle-label'>Queja de Memoria</label>\n+                                        <label className=\"toggle\">\n                                             <input id='memoryCheckbox' type='checkbox' name = 'memoryComplaint' onChange = {onChange} />\n-                                            <span class = \"slider\"></span>\n-                                            <span class =\"labels\" data-on=\"SI\" data-off=\"NO\"></span>\n+                                            <span className = \"slider\"></span>\n+                                            <span className =\"labels\" data-on=\"SI\" data-off=\"NO\"></span>\n                                         </label>\n                                     </div>\n-                                    <div class ='toggle-div'>    \n-                                        <label class ='toggle-label'>Hipoacusia severa</label>\n-                                        <label class=\"toggle\">\n+                                    <div className ='toggle-div'>    \n+                                        <label className ='toggle-label'>Hipoacusia severa</label>\n+                                        <label className=\"toggle\">\n                                         <input id='hearingCheckbox' type='checkbox' name = 'severeHearingLoss' onChange = {onChange} />\n-                                            <span class = \"slider\"></span>\n-                                            <span class =\"labels\" data-on=\"SI\" data-off=\"NO\"></span>\n+                                            <span className = \"slider\"></span>\n+                                            <span className =\"labels\" data-on=\"SI\" data-off=\"NO\"></span>\n                                         </label>\n                                     </div>\n                                 ",
      "@@ -1,78 +0,0 @@\n-import React, {useState} from 'react'\n-import { useNavigate  } from \"react-router-dom\"\n-\n-\n-const NewPatient = () => {\n-    \n-    //allow to navigate through the routes\n-    const navigate = useNavigate ();\n-\n-    //user register fields\n-    const [user,setUser] = useState({\n-        name: '',\n-        lastName: '',\n-        motherLastName: '',\n-        birthday: '',\n-        gender: '',\n-        scholarity: '',\n-        disabilities: '',\n-        memoryComplaint: '',\n-        severeHearingLoss: '',\n-        emergencyContact: '',\n-        profileImage: ''\n-    });\n-\n-    const {name, lastName, motherLastName, birthday, gender, scholarity, disabilities, memoryComplaint, severeHearingLoss, emergencyContact, image} = user;\n-\n-    //copies user data and changes the target of the onchange\n-    const onChange = e => setUser({...user, [e.target.name]:e.target.value});\n-\n-    const onSubmit = e => {\n-        e.preventDefault();\n-\n-        if(name === '' || lastName === '' || motherLastName === '' || birthday === '' || gender === '' || scholarity === '' || disabilities === '' || memoryComplaint === '' || severeHearingLoss === '' || emergencyContact === ''){\n-            //missing info\n-        }else{\n-            //register\n-            navigate('/home');\n-        }\n-    }\n-    \n-    //El onfocus=\"(this.type='date')\" no sirve\n-    return (\n-        <div className='grid-2'>\n-            <div className='form-container'>\n-                <h2 className='auth-header'>Add New Patient</h2>\n-                <form onSubmit={onSubmit}>\n-                    <div className='grid-2'>\n-                        <div>\n-                            <input placeholder='Nombre' type='text' name = 'name' value={name} onChange = {onChange} required/>\n-                            <input placeholder='Apellido Paterno' type='text' name = 'lastName' value={lastName} onChange = {onChange} required/>\n-                            <input placeholder='Apellido Materno' type='text' name = 'motherLastName' value={motherLastName} onChange = {onChange} required/>\n-                            <label for=\"fe\">Fecha de Nacimiento</label>\n-                            <input type='date' name = 'birthday' value={birthday} onChange = {onChange} required/>\n-                            <select  id=\"sexos\" name='sex' onChange = {onChange}>\n-                                <option value=\"Masculino\">Masculino</option>\n-                                <option value=\"Femenino\">Femenino</option>\n-                            </select >\n-                        </div>\n-                        <div>\n-                            <input placeholder='Escolaridad' type='text' name = 'scholarity' value={scholarity} onChange = {onChange} required/>\n-                            <input placeholder='Discapacidades' type='text' name = 'disabilities' value={disabilities} onChange = {onChange} required/>\n-                            <label>Queja de memoria</label>\n-                            <input placeholder='Queja de memoria' type='checkbox' name = 'memoryComplaint' value={memoryComplaint} onChange = {onChange} />\n-                            <label>Hipoacusia severa</label>\n-                            <input placeholder='Hipoacusia severa' type='checkbox' name = 'severeHearingLoss' value={severeHearingLoss} onChange = {onChange} />\n-                            <input placeholder='Contacto de Emergencia' type='number' name = 'emergencyContact' value={emergencyContact} onChange = {onChange} required/>\n-                            <input placeholder='URL Foto de perfil' type = 'text' id = \"files\" value={image} accept=\"image/png, image/jpeg\" onChange = {onChange}/>\n-                        </div>\n-                    </div>\n-                    <input type=\"submit\" value = \"Agregar Paciente\" formTarget='_blank'/>\n-                </form>\n-                <button className='btn-back' onClick={() => navigate('/home')}> Atr\u00e1s</button>\n-            </div>\n-        </div>\n-    )\n-}\n-\n-export default NewPatient;",
      "@@ -1,4 +1,4 @@\n-import React, {useState} from 'react'\n+import React, {useState,useEffect} from 'react'\n import Navbar from '../Navbar'\n import BubbleCard from '../visual/BubbleCard'\n import ListCard from '../visual/ListCard'\n@@ -10,19 +10,31 @@ import { useNavigate  } from \"react-router-dom\"\n import { IconBase } from 'react-icons'\n import AddPatientButton from '../newPatient/AddPatientButton'\n import SearchBar from \"../searchBar/searchBar\";\n+import axios from 'axios';\n+import { useAlert } from 'react-alert'\n \n const Home = () => {\n+  const alert = useAlert()\n   const navigate = useNavigate ();\n+  const [datos, setData] = useState(null);\n \n-  const loadPatients = () => {\n-    fetch(\"/patients\").then((res) => res.json()).then((data) => setData(data.message));\n+  const loadPatients = async () => {\n+    try {\n+      const res = await axios.get('/patients');\n+      setData(res.data.message);\n+      alert.success('Patients loaded');\n+    } catch (error) {\n+      alert.error('Error while fetching patients');\n+    }\n   }\n-  const [datos, setData] = React.useState(null);\n-  React.useEffect(() => {\n-    fetch(\"/patients\")\n-      .then((res) => res.json())\n-      .then((data) => setData(data.message));\n-  }, []);\n+\n+  useEffect(() => {\n+    if(!localStorage.token){\n+      navigate('/');\n+    }else{\n+      loadPatients();\n+    }\n+  },[]);\n \n   const OpenPatientCard = (currentPatient) => {\n     //allow to naviigate through the routes\n@@ -43,8 +55,6 @@ const Home = () => {\n   const query = new URLSearchParams(search).get('s');\n   const [searchQuery, setSearchQuery] = useState(query || '');\n   const filteredPosts = filterPosts(datos, searchQuery);\n-  \n-  \n \n   const [tipoVista, setVista] = useState(\"Grid\");\n   //loadPatients(); En caso de que quieran drenar la memoria activenlo, pero se activa un listener para nuevos datos",
      "@@ -2,7 +2,9 @@ import './Moca.css';\n \r\n import Unity, {UnityContext} from 'react-unity-webgl';\r\n import { Fragment, useEffect, useState } from 'react';\r\n-import { Navigate, useParams } from \"react-router-dom\";\r\n+import { Navigate, useParams, useNavigate } from \"react-router-dom\";\r\n+import axios from 'axios';\r\n+import { useAlert } from 'react-alert'\r\n \r\n const unityContext = new UnityContext({\r\n   productName: \"Geriatrik\",\r\n@@ -18,6 +20,8 @@ const unityContext = new UnityContext({\n }); \r\n \r\n function Moca() {\r\n+  const navigate = useNavigate ();\r\n+  const alert = useAlert();\r\n   const [isUnityMounted, setIsUnityMounted] = useState(true);\r\n   const [isLoaded, setIsLoaded] = useState(false);\r\n   const [progression, setProgression] = useState(0);\r\n@@ -26,13 +30,18 @@ function Moca() {\n   const {idEmpleado, idPaciente} = useParams();\r\n \r\n   useEffect(function(){\r\n-    unityContext.on(\"progress\", handleOnUnityProgress);\r\n-    unityContext.on(\"loaded\", handleOnUnityLoaded);\r\n-    unityContext.on(\"MocaFinished\", handleMocaFinish);\r\n-\r\n-    return function(){\r\n-      unityContext.removeAllEventListeners();\r\n-    };\r\n+    if(!localStorage.token){\r\n+      navigate('/');\r\n+    }else{\r\n+      unityContext.on(\"progress\", handleOnUnityProgress);\r\n+      unityContext.on(\"loaded\", handleOnUnityLoaded);\r\n+      unityContext.on(\"MocaFinished\", handleMocaFinish);\r\n+\r\n+      return function(){\r\n+        unityContext.removeAllEventListeners();\r\n+      };\r\n+    }\r\n+    \r\n   }, []);\r\n \r\n   function handleOnUnityProgress(progression) {\r\n@@ -66,13 +75,26 @@ function Moca() {\n     respuesta[\"puntos\"] = mocaRes.resultados.total;\r\n     respuesta[\"respuestasJSON\"] = results.replace(/(\\r\\n|\\n|\\r)/gm, \"\");\r\n \r\n-    fetch(\"/moca\", {\r\n+    try {\r\n+      const config = {\r\n+        headers: {\r\n+            'Content-Type': 'application/json; charset=UTF-8'\r\n+        }\r\n+    }\r\n+      const res = await axios.post('/moca',JSON.stringify(respuesta),config);\r\n+      if(res){\r\n+        alert.success('Test saved');\r\n+      }\r\n+    } catch (error) {\r\n+      alert.error('Failed to save test');\r\n+    }\r\n+    /*fetch(\"/moca\", {\r\n       method: 'POST',\r\n       headers:{\r\n         'Content-type': 'application/json; charset=UTF-8'\r\n       },\r\n       body: JSON.stringify(respuesta)\r\n-    });\r\n+    });*/\r\n   }\r\n \r\n   function handleOnClickUnMountUnity() {\r",
      "@@ -6,8 +6,11 @@ import TestButton from \"../../TestButton\";\n import TestGraph from \"../../graph/TestGraph\";\r\n import { Bar } from \"react-chartjs-2\";\r\n import ListCardTest from \"./ListCardTest\";\r\n-import { useParams } from \"react-router-dom\";\r\n+import { useParams, useNavigate } from \"react-router-dom\";\r\n import BackButton from '../../BackButton'\r\n+import axios from 'axios';\r\n+import { useAlert } from 'react-alert'\r\n+\r\n \r\n const HomeLink = \"/moca/\";\r\n \r\n@@ -16,30 +19,42 @@ const HomeLink = \"/moca/\";\n \r\n const Details = (props) => {\r\n   const { id } = useParams(); // pacienteId\r\n-  const [datos, setData] = React.useState(null);\r\n+  const [datos, setData] = useState(null);\r\n   let valuesArray;\r\n \r\n-  if(datos) {\r\n-    var graphData = datos.map((currentGraph) => {\r\n-    return(\r\n-      currentGraph.puntos\r\n-    );\r\n-    });\r\n-    var graphDates = datos.map((currentGraph) => {\r\n+  const loadData = async () => {\r\n+    try {\r\n+      const res = await axios.get(`/tamizaje/${encodeURIComponent(props.patientID)}\"`);\r\n+      console.log(res);\r\n+      setData(res.data.message);\r\n+      console.log(datos);\r\n+\r\n+      alert.success('Data loaded');\r\n+\r\n+    } catch (error) {\r\n+      alert.error('Error while fetching data');\r\n+    }\r\n+  }\r\n+  useEffect(() => {\r\n+    loadData();\r\n+    if(datos) {\r\n+      var graphData = datos.map((currentGraph) => {\r\n       return(\r\n-        currentGraph.fecha\r\n+        currentGraph.puntos\r\n       );\r\n       });\r\n-  }\r\n-  \r\n-\r\n-  React.useEffect(() => {\r\n-    fetch(`/tamizaje/${encodeURIComponent(props.patientID)}\"`, {\r\n+      var graphDates = datos.map((currentGraph) => {\r\n+        return(\r\n+          currentGraph.fecha\r\n+        );\r\n+        });\r\n+    }\r\n+    /*fetch(`/tamizaje/${encodeURIComponent(props.patientID)}\"`, {\r\n       method: \"GET\",\r\n       headers: { \"Content-Type\": \"application/json\" },\r\n     })\r\n       .then((res) => res.json())\r\n-      .then((data) => setData(data.message));\r\n+      .then((data) => setData(data.message));*/\r\n   }, []);\r\n   // console.log(datos);\r\n \r\n@@ -53,7 +68,7 @@ const Details = (props) => {\n   if (datos) {\r\n     var graphDates = datos.map((currentGraph)  => {\r\n       return (\r\n-        currentGraph.fecha\r\n+        currentGraph.fecha.slice(0, 10)\r\n       );\r\n     });\r\n   }\r\n@@ -73,7 +88,7 @@ const Details = (props) => {\n   // }\r\n \r\n   function getMocaLink(){\r\n-    return `/moca/${1}/${id}`\r\n+    return `/moca/${localStorage.getItem('id')}/${id}`\r\n   }\r\n   //localStorage.getItem(\"id\")\r\n \r\n@@ -131,6 +146,9 @@ const Details = (props) => {\n             <tbody>\r\n               {datos ? (\r\n                 datos.map((currentTest) => {\r\n+                  \r\n+                  currentTest.fecha = currentTest.fecha.slice(0, 10);\r\n+\r\n                   return (\r\n                     <ListCardTest\r\n                       testObj={currentTest}\r\n@@ -192,11 +210,31 @@ const getEdad = (dateString) => {\n const Patient = () => {\r\n   const { id } = useParams();\r\n   const [datos, setData] = React.useState(null);\r\n-  React.useEffect(() => {\r\n-    fetch(\"/patient/\" + id)\r\n+  const alert = useAlert();\r\n+  const navigate = useNavigate();\r\n+  const loadPatient = async () =>{\r\n+    try {\r\n+      const res = await axios.get(\"/patient/\" + id);\r\n+      setData(res.data.message);\r\n+      console.log(datos);\r\n+\r\n+      alert.success('Patient loaded');\r\n+\r\n+    } catch (error) {\r\n+      alert.error('Error while fetching data');\r\n+    }\r\n+  }\r\n+\r\n+  useEffect(() => {\r\n+    if(!localStorage.token){\r\n+      navigate('/');\r\n+    }else{\r\n+      loadPatient();\r\n+    }\r\n+    /*fetch(\"/patient/\" + id)\r\n       .then((res) => res.json())\r\n-      .then((data) => setData(data.message));\r\n-  }, [id]);\r\n+      .then((data) => setData(data.message));*/\r\n+  }, []);\r\n   return !datos ? (\r\n     <h1>Loading</h1>\r\n   ) : (\r",
      "@@ -0,0 +1,16 @@\n+import axios from 'axios';\n+\n+const setAuthToken = token =>{\n+    if(token){\n+        //backend header in which we send the token\n+        //sets a default config to use in every request\n+        /*this allows us to mantain the authorization \n+        in all of our app without having to make a request for the token \n+        each time we need it*/\n+        axios.defaults.headers.common['x-auth-token'] = token;\n+    }else{\n+        delete axios.defaults.headers.common['x-auth-token'];\n+    }\n+}\n+\n+export default setAuthToken;\n\\ No newline at end of file"
    ]
  },
  {
    "message": "Merge pull request #6 from CarloLj/login/register\n\nminor design changes",
    "additions": [
      "@@ -61,7 +61,7 @@ const Login = () => {\n                         <i className=\"bi bi-eye\" id=\"togglePassword\" onClick={showPassword}/>\n                         <input id = \"password\" placeholder='Contrase\u00f1a' type='password' name = 'password' value={password} onChange = {onChange} required/>\n                     </div>\n-                    <p style={{margin: '15px', cursor: 'pointer',textDecoration: 'underline'}} onClick = {() => navigate('/register', { replace: true })}>\u00bfNo tienes cuenta? Registrate</p>\n+                    <p style={{margin: '15px', cursor: 'pointer',textDecoration: 'underline'}} onClick = {() => navigate('/register')}>\u00bfNo tienes cuenta? Registrate</p>\n                     <input type=\"submit\" value = \"Iniciar Sesi\u00f3n\"/>\n                 </form>\n             </div>",
      "@@ -103,7 +103,7 @@ const Register = props => {\n                         <br/>\n                     <input type=\"submit\" value = \"Registarse\"/>\n                 </form>\n-                <button style = {{marginBottom:'5%'}} className='btn-back' onClick={() => navigate('/', { replace: true })}> Atr\u00e1s</button>\n+                <button style = {{marginBottom:'5%'}} className='btn-back' onClick={() => navigate('/')}> Atr\u00e1s</button>\n             </div>\n             <div>\n                 <center>",
      "@@ -99,7 +99,7 @@\n   #togglePassword2,\n   #togglePassword{\n     position: relative;\n-    left: 90%;\n+    left: 85%;\n     top: 10px;\n     padding: 10px;\n     cursor: pointer;"
    ]
  }
]